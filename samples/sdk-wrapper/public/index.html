<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.opentok.com/v2/js/opentok.min.js"></script>
  <script src="dist/sdk.js"></script>
  <link rel="stylesheet" href="styles.css" />
  <title>OT SDK Wrapper</title>

</head>

<body>

  <div id="publishers"></div>
  <div id="subscribers"></div>

  <script type="text/javascript">
    const credentials = {
      "apiKey": "47088884",
      "sessionId": "1_MX40NzA4ODg4NH5-MTYxMTMzMDQxMDE1MX4vVDU5a3FZL2NqbGlwZVE0akhCSVl5VXN-fg",
      "token": "T1==cGFydG5lcl9pZD00NzA4ODg4NCZzaWc9ZTM2MjM2YmJjNjk3ZTY1NGQwNmVkMGM4ODVjNTYzMDg5YmU1NWNiMDpzZXNzaW9uX2lkPTFfTVg0ME56QTRPRGc0Tkg1LU1UWXhNVE16TURReE1ERTFNWDR2VkRVNWEzRlpMMk5xYkdsd1pWRTBha2hDU1ZsNVZYTi1mZyZjcmVhdGVfdGltZT0xNjExMzMwNDE4Jm5vbmNlPTAuNTEwNDA2MDkxMjcwNDUwOSZyb2xlPXB1Ymxpc2hlciZleHBpcmVfdGltZT0xNjExMzM0MDE2JmluaXRpYWxfbGF5b3V0X2NsYXNzX2xpc3Q9"
    };

    const callProperties = {
      insertMode: 'append',
      width: '100%',
      height: '100%',
      showControls: true
    };
    const otSDK = new OpenTokSDK(credentials);
    let state;

    const subscribeToStream = stream => {
      const type = stream.videoType;
      otSDK.subscribe(stream, `${type}SubscriberContainer`, callProperties);
    };

    otSDK.connect().then(() => {

      const session = otSDK.getSession();

      session.streams.forEach(subscribeToStream);

      otSDK.on({
        'streamCreated': ({ stream }) => subscribeToStream(stream)
      });

      otSDK.publish('publishers', callProperties).then((publisher) => {
        state = otSDK.state();
      }).catch(error => console.log(error));
    });

  </script>
</body>

</html>
